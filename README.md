# ğŸ¦™ LLaMA Factory å­¦ä¹ ç¬”è®°

> **å‚è€ƒèµ„æ–™**  
> - [LLaMA Factoryï¼ˆä¸€ï¼‰](https://mp.weixin.qq.com/s/aQCY8873d09zFIhMhrx7Pg)
> - [LLaMA Factoryï¼ˆäºŒï¼‰](https://mp.weixin.qq.com/s/N8LdX3eRuaIJ-yxkpxZJ5w)
> - [Bilibili æ•™ç¨‹è§†é¢‘](https://www.bilibili.com/video/BV1oTEwzcEeZ?t=0.2)
---

## ä¸€ã€ä»‹ç»

### ğŸ§© 1. å…¨åœºæ™¯æ¨¡å‹å¾®è°ƒèƒ½åŠ›

- **å¤šæ¨¡å‹æ”¯æŒ**ï¼šé«˜æ•ˆé€‚é…è¶… 100 ä¸ªä¸»æµæ¨¡å‹ï¼Œæ¶µç›– Qwenã€DeepSeekã€LLaMAã€Gemmaã€LLaVAã€Mistralã€Mixtral-MoEã€Yiã€Baichuanã€ChatGLMã€Phi ç­‰ï¼Œæ»¡è¶³ NLPã€å¤šæ¨¡æ€ç­‰å¤šé¢†åŸŸéœ€æ±‚ã€‚  
- **å¤šæ ·åŒ–ç®—æ³•ä¸ç²¾åº¦**ï¼šé›†æˆ LoRAã€GaLoreã€DoRA ç­‰å¾®è°ƒæŠ€æœ¯ï¼Œæ”¯æŒï¼ˆå¢é‡ï¼‰é¢„è®­ç»ƒã€ï¼ˆå¤šæ¨¡æ€ï¼‰æŒ‡ä»¤ç›‘ç£å¾®è°ƒã€å¥–åŠ±æ¨¡å‹è®­ç»ƒã€PPO/DPO/KTO/ORPO ç­‰å¼ºåŒ–å­¦ä¹ æ–¹æ³•ï¼›æä¾› 16 æ¯”ç‰¹å…¨å‚æ•°å¾®è°ƒã€å†»ç»“å¾®è°ƒã€LoRA å¾®è°ƒï¼Œä»¥åŠåŸºäº AQLM/AWQ/GPTQ ç­‰æŠ€æœ¯çš„ 2/3/4/5/6/8 æ¯”ç‰¹ QLoRA ä½æ¯”ç‰¹é‡åŒ–å¾®è°ƒã€‚  
- **æ•°æ®é›†çµæ´»é…ç½®**ï¼šæ”¯æŒè‡ªå®šä¹‰æˆ–ç¤¾åŒºæ•°æ®é›†ï¼ˆHuggingFaceã€ModelScopeï¼‰ï¼Œè‡ªåŠ¨ä¸‹è½½ç¼“å­˜æ¨¡å‹ä¸æ•°æ®é›†ï¼Œé€‚é…å¤šå¡è®­ç»ƒã€‚  
- **å¤šç§åŠ é€ŸæŠ€å·§**ï¼šæ”¯æŒ FlashAttention-2ã€Unsloth ç­‰é«˜æ•ˆç®—å­ã€‚

### âš™ï¸ 2. æç®€æ“ä½œä¸é«˜æ•ˆå·¥å…·é“¾

- **é›¶ä»£ç  Web UI**ï¼šé€šè¿‡å¯è§†åŒ–ç•Œé¢å®Œæˆæ¨¡å‹é…ç½®ã€æ•°æ®åŠ è½½ã€å‚æ•°è°ƒä¼˜ã€è®­ç»ƒç›‘æ§ä¸æ—¥å¿—æŸ¥çœ‹ã€‚  
- **å®æ—¶ç›‘æ§ä¸è¯„ä¼°**ï¼šé›†æˆ Wandbã€MLflowã€SwanLabã€TensorBoard ç­‰å·¥å…·å®ç°å¯è§†åŒ–è®­ç»ƒä¸æ€§èƒ½åˆ†æã€‚

### ğŸ§± 3. å·¥ç¨‹åŒ–éƒ¨ç½²ä¸èµ„æºåˆ©ç”¨

- **æ¨¡å‹éƒ¨ç½²**ï¼šLoRA é€‚é…å™¨å¯ä¸€é”®åˆå¹¶ä¸ºå®Œæ•´æ¨¡å‹ï¼Œä¾¿äºæœ¬åœ°åŒ–éƒ¨ç½²ã€‚  
- **æ¨ç†å¼•æ“**ï¼šå†…ç½® Transformers ä¸åŸºäº vLLM çš„ OpenAI é£æ ¼ APIã€‚  
- **èµ„æºä¼˜åŒ–**ï¼šæ”¯æŒå•æœºå¤šå¡ä¸å¤šç¡¬ä»¶é€‚é…ã€‚

---

## äºŒã€LLaMA Factory VS Unsloth

| å¯¹æ¯”é¡¹ | **LLaMA Factory** | **Unsloth** |
| :-- | :-- | :-- |
| **ä¸»è¦ç‰¹ç‚¹** | å…¨åœºæ™¯å¾®è°ƒå¹³å°ï¼Œæ”¯æŒå¤šæ¨¡å‹ä¸å¼ºåŒ–å­¦ä¹  | é«˜é€Ÿä½æ˜¾å­˜çš„å¾®è°ƒå·¥å…· |
| **æ€§èƒ½ä¼˜åŒ–** | æ”¯æŒå¤šç§åŠ é€ŸæŠ€æœ¯ä¸é‡åŒ–å¾®è°ƒ | å¾®è°ƒé€Ÿåº¦æå‡ 2-5 å€ï¼Œæ˜¾å­˜å ç”¨ä¸‹é™ 50%-80% |
| **ç¡¬ä»¶éœ€æ±‚** | é€‚é…å¤šå¡ä¸ä¼ä¸šçº§ GPU | 7GB æ˜¾å­˜å¯è®­ç»ƒ 1.5B å‚æ•°æ¨¡å‹ |
| **é€‚ç”¨åœºæ™¯** | ä¼ä¸šçº§éƒ¨ç½²ã€é€šç”¨ä»»åŠ¡ã€é›¶ä»£ç ç”¨æˆ· | ä¸ªäººå¼€å‘è€…ã€ä½èµ„æºåœºæ™¯ã€å¿«é€Ÿè¿­ä»£ |
| **å¯è§†åŒ–æ”¯æŒ** | WebUIã€API Serverã€ç›‘æ§ç³»ç»Ÿ | Colab Notebook å¿«é€Ÿä¸Šæ‰‹ |

> âœ… **ç»“è®º**ï¼š  
> - **Unsloth**ï¼šé€‚åˆèµ„æºæœ‰é™ã€éœ€è¦å¿«é€Ÿå®éªŒçš„åœºæ™¯ã€‚  
> - **LLaMA Factory**ï¼šé€‚åˆé€šç”¨å¤§æ¨¡å‹è®­ç»ƒã€ä¼ä¸šéƒ¨ç½²ä¸æ•™å­¦å±•ç¤ºã€‚

---

## ä¸‰ã€å®‰è£…æ–¹å¼

æ¨èä½¿ç”¨ **Conda è™šæ‹Ÿç¯å¢ƒ** è¿›è¡Œéš”ç¦»å®‰è£…ã€‚

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
conda create -n llama_factory python=3.10
conda activate llama_factory

# å®‰è£…ä¾èµ–
pip install -U pip
pip install -U llama-factory
````

---

## å››ã€WebUI æ¨¡å—ç»“æ„

LLaMA Factory çš„ WebUI å¯åˆ†ä¸ºäº”å¤§æ¨¡å—ï¼š

1. **é€šç”¨è®¾ç½®**ï¼š
   è®¾ç½®è¯­è¨€ã€æ¨¡å‹ã€å¾®è°ƒæ–¹å¼ã€é‡åŒ–ä¸åŠ é€Ÿæ–¹å¼ã€‚

2. **å¾®è°ƒè®­ç»ƒ**ï¼š

   * è®­ç»ƒé˜¶æ®µï¼ˆé¢„è®­ç»ƒ / æŒ‡ä»¤å¾®è°ƒ / å¼ºåŒ–å­¦ä¹ ï¼‰
   * æ•°æ®é›†é…ç½®ä¸éªŒè¯æ¯”ä¾‹
   * å­¦ä¹ ç‡ã€è½®æ•°ã€æ‰¹é‡å¤§å°ç­‰å…³é”®å‚æ•°
   * LoRAã€RLHFã€ä¼˜åŒ–å™¨å‚æ•°
   * SwanLab è®­ç»ƒå¯è§†åŒ–å‚æ•°

3. **æ¨¡å‹è¯„ä¼°**ï¼š

   * ä½¿ç”¨æŒ‡å®šæ•°æ®é›†å¯¹æ¨¡å‹è¿›è¡ŒéªŒè¯ä¸æ•ˆæœæµ‹è¯•ã€‚

4. **åœ¨çº¿æ¨ç†**ï¼š

   * æ”¯æŒ HuggingFaceã€vLLM ç­‰æ¨ç†å¼•æ“ï¼Œå®ç°æ¨¡å‹å¯¹è¯æµ‹è¯•ã€‚

5. **æ¨¡å‹å¯¼å‡º**ï¼š

   * å¯é…ç½®å¯¼å‡ºæ¨¡å‹ã€é€‚é…å™¨ã€é‡åŒ–ç­‰çº§ã€è®¾å¤‡ä¸ç›®å½•ã€‚

---

## äº”ã€å¾®è°ƒé€šç”¨è®¾ç½®

### ğŸ” 1. é€‰æ‹©æ¨¡å‹

| åˆ†ç±»      | æ ‡è¯†          | å«ä¹‰         | ç¤ºä¾‹                             |
| :------ | :---------- | :--------- | :----------------------------- |
| åŠŸèƒ½ä¸ä»»åŠ¡ç±»å‹ | Base        | åŸºç¡€æ¨¡å‹ï¼ˆåŸå§‹èƒ½åŠ›ï¼‰ | Qwen3-14B-Base                 |
|         | Chat        | å¯¹è¯ä¼˜åŒ–æ¨¡å‹     | DeepSeek-LLM-7B-Chat           |
|         | Instruct    | æŒ‡ä»¤å¾®è°ƒæ¨¡å‹     | Qwen3-0.6B-Instruct            |
|         | Distill     | çŸ¥è¯†è’¸é¦æ¨¡å‹     | DeepSeek-R1-1.5B-Distill       |
|         | Math        | æ•°å­¦æ¨ç†æ¨¡å‹     | DeepSeek-Math-7B-Instruct      |
|         | Coder       | ç¼–ç¨‹ä»»åŠ¡æ¨¡å‹     | DeepSeek-Coder-V2-16B          |
| å¤šæ¨¡æ€     | VL          | è§†è§‰-è¯­è¨€æ¨¡å‹    | Kimi-VL-A3B-Instruct           |
|         | Video       | è§†é¢‘å¤šæ¨¡æ€æ¨¡å‹    | LLaVA-NeXT-Video-7B-Chat       |
|         | Audio       | éŸ³é¢‘è¾“å…¥æ¨¡å‹     | Qwen2-Audio-7B                 |
| æŠ€æœ¯ç‰¹æ€§    | Int8 / Int4 | æƒé‡é‡åŒ–æ¨¡å‹     | Qwen2-VL-2B-Instruct-GPTQ-Int8 |
|         | AWQ / GPTQ  | ç‰¹å®šé‡åŒ–æŠ€æœ¯     | Qwen2.5-VL-72B-Instruct-AWQ    |
|         | MoE         | æ··åˆä¸“å®¶æ¨¡å‹     | DeepSeek-MoE-16B-Chat          |
|         | RL          | å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–æ¨¡å‹   | MiMo-7B-Instruct-RL            |
| ç‰ˆæœ¬      | v0.1 / v0.2 | æ¨¡å‹ç‰ˆæœ¬å·      | Mistral-7B-v0.1                |
| å˜ä½“      | Pure        | çº¯å‡€ç‰ˆæ¨¡å‹      | Index-1.9B-Base                |
|         | Character   | è§’è‰²å¯¹è¯æ¨¡å‹     | Index-1.9B-Character-Chat      |
|         | Long-Chat   | é•¿ä¸Šä¸‹æ–‡æ¨¡å‹     | Orion-14B-Long-Chat            |
| åº”ç”¨é¢†åŸŸ    | RAG         | æ£€ç´¢å¢å¼ºç”Ÿæˆæ¨¡å‹   | Orion-14B-RAG-Chat             |
|         | Chinese     | ä¸­æ–‡ä¼˜åŒ–æ¨¡å‹     | Llama-3-70B-Chinese-Chat       |
|         | MT          | ç¿»è¯‘æ¨¡å‹       | BLOOMZ-7B1-mt                  |

---

### âš™ï¸ 2. å¾®è°ƒæ–¹æ³•

#### ğŸ§  **Fullï¼ˆå…¨å‚æ•°å¾®è°ƒï¼‰**

* **æ¦‚å¿µ**ï¼šè®­ç»ƒå…¨éƒ¨å‚æ•°ï¼Œæœ€å¤§åŒ–æ€§èƒ½ã€‚
* **ç±»æ¯”**ï¼šæ‹†æ‰æˆ¿å­é‡å»ºã€‚
* **ä¼˜ç‚¹**ï¼šæ€§èƒ½æœ€å¼ºã€å®Œå…¨é€‚åº”æ€§é«˜ã€‚
* **ç¼ºç‚¹**ï¼šæ˜¾å­˜ä¸è®¡ç®—é‡éœ€æ±‚æé«˜ã€‚
* **é€‚ç”¨åœºæ™¯**ï¼šæœ‰å……è¶³ç®—åŠ›ã€æ•°æ®é‡å¤§ã€ä»»åŠ¡å·®å¼‚å¤§ã€‚

---

#### ğŸ§© **Freezeï¼ˆå‚æ•°å†»ç»“å¾®è°ƒï¼‰**

* **æ¦‚å¿µ**ï¼šå†»ç»“éƒ¨åˆ†å‚æ•°ï¼Œä»…è®­ç»ƒéƒ¨åˆ†å±‚ã€‚
* **ç±»æ¯”**ï¼šç»™æˆ¿å­å±€éƒ¨è£…ä¿®ã€‚
* **ä¼˜ç‚¹**ï¼šè®¡ç®—æ•ˆç‡é«˜ã€é˜²æ­¢è¿‡æ‹Ÿåˆã€èŠ‚çœå†…å­˜ã€‚
* **ç¼ºç‚¹**ï¼šæ€§èƒ½å¯èƒ½ç•¥ä½ã€éœ€ä¸“ä¸šè°ƒå‚ã€‚
* **é€‚ç”¨åœºæ™¯**ï¼šèµ„æºæœ‰é™ã€å°æ•°æ®é›†ã€ä»»åŠ¡ç›¸ä¼¼ã€‚

---

#### ğŸ”— **LoRAï¼ˆä½ç§©é€‚é…å¾®è°ƒï¼‰**

* **æ¦‚å¿µ**ï¼šé€šè¿‡æ³¨å…¥å°å‹å¯è®­ç»ƒçŸ©é˜µå®ç°é«˜æ•ˆå¾®è°ƒã€‚
* **ç±»æ¯”**ï¼šç»™æˆ¿å­åŠ æ™ºèƒ½æ¨¡å—ã€‚
* **ä¼˜ç‚¹**ï¼š

  * è®­ç»ƒå‚æ•°å‡å°‘ 99%+
  * æ˜¾å­˜å ç”¨ä½ã€é€Ÿåº¦å¿«
  * æ”¯æŒå¤šä»»åŠ¡é€‚é…ä¸è½»é‡åŒ–éƒ¨ç½²
* **ç¼ºç‚¹**ï¼š

  * æ€§èƒ½ä¸Šé™ç•¥ä½
  * è¶…å‚æ•°è°ƒèŠ‚å¤æ‚
* **é€‚ç”¨åœºæ™¯**ï¼š

  * GPU èµ„æºæœ‰é™
  * éœ€å¿«é€Ÿé€‚é…æ–°ä»»åŠ¡
  * å¤šæ¨¡æ€ä»»åŠ¡ä¸è¿­ä»£ä¼˜åŒ–åœºæ™¯

> ğŸ’¡ **LoRA å¾®è°ƒæ˜¯å½“å‰ä¸»æµæ–¹æ³•**ï¼š
> åœ¨ä¿æŒé¢„è®­ç»ƒæƒé‡ä¸å˜çš„æƒ…å†µä¸‹ï¼ŒLoRA é€šè¿‡ä½ç§©çŸ©é˜µå­¦ä¹ ç‰¹å®šä»»åŠ¡ç‰¹å¾ï¼Œå®ç°å¿«é€Ÿæ”¶æ•›ã€ä½æ˜¾å­˜å ç”¨ä¸è‰¯å¥½æ³›åŒ–æ€§èƒ½ã€‚

---

### 3. æ¨¡å‹é‡åŒ–ï¼ˆModel Quantizationï¼‰

æ¨¡å‹é‡åŒ–ä¸è’¸é¦åŒå±äº **æ¨¡å‹å‹ç¼©ï¼ˆModel Compressionï¼‰** æŠ€æœ¯ã€‚  
å¯¹äºå‚æ•°é‡å·¨å¤§çš„æ¨¡å‹ï¼ˆå¦‚ DeepSeek-R1 6710Bã€Qwen3 235B ç­‰ï¼‰ï¼Œç›´æ¥éƒ¨ç½²æˆæœ¬æé«˜ï¼Œå› æ­¤é€šå¸¸é€šè¿‡é‡åŒ–æˆ–è’¸é¦é™ä½æ¨¡å‹å¤æ‚åº¦ï¼Œåœ¨ **è½»å¾®ç²¾åº¦æŸå¤±** çš„æƒ…å†µä¸‹æ˜¾è‘—å‡å°‘æ˜¾å­˜ä¸è®¡ç®—éœ€æ±‚ã€‚

#### ğŸŒ ä»€ä¹ˆæ˜¯æ¨¡å‹é‡åŒ–ï¼Ÿ

æ¨¡å‹é‡åŒ–æ˜¯ä¸€ç§é€šè¿‡**é™ä½æƒé‡ä¸æ¿€æ´»å€¼çš„æ•°å€¼ç²¾åº¦**æ¥å‡å°‘æ¨¡å‹å¤§å°ã€åŠ å¿«æ¨ç†é€Ÿåº¦ï¼ŒåŒæ—¶å°½é‡ä¿æŒå‡†ç¡®ç‡çš„æŠ€æœ¯ã€‚  
ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯â€œç”¨æ›´å°‘çš„æ¯”ç‰¹å»å­˜å‚¨æ¨¡å‹å‚æ•°â€ã€‚

> ğŸ§ ç±»æ¯”ç†è§£ï¼š  
> ä»æ— æŸéŸ³ä¹ï¼ˆFLACï¼‰åˆ°å‹ç¼©éŸ³ä¹ï¼ˆMP3ï¼‰  
> - FLAC â‰ˆ FP32 ç²¾åº¦æ¨¡å‹ï¼ˆå®Œæ•´ä½†å¤§ï¼‰  
> - MP3 â‰ˆ INT8/INT4 é‡åŒ–æ¨¡å‹ï¼ˆæ›´å°ä½†ç•¥æœ‰ç²¾åº¦æŸå¤±ï¼‰

---

#### ğŸ§® æ¨¡å‹å‚æ•°ä¸ç²¾åº¦å•ä½

æ¨¡å‹å‚æ•°é€šå¸¸ä»¥æµ®ç‚¹æ•°å­˜å‚¨ã€‚å¸¸è§ç²¾åº¦æ ¼å¼åŒ…æ‹¬ï¼š

| ç²¾åº¦ç±»å‹ | ç¤ºä¾‹ | å«ä¹‰ | ç‰¹ç‚¹ |
|-----------|--------|------|------|
| **FPï¼ˆFloating Pointï¼‰** | FP16 / FP32 | æ ‡å‡†æµ®ç‚¹æ•°æ ¼å¼ | é«˜ç²¾åº¦ï¼Œä½†å ç”¨æ˜¾å­˜å¤š |
| **BFï¼ˆBrain Floating Pointï¼‰** | BF16 | ä¸ºæ·±åº¦å­¦ä¹ ä¼˜åŒ–çš„æµ®ç‚¹è¡¨ç¤º | ç²¾åº¦ä¸æ•ˆç‡å¹³è¡¡ |
| **INTï¼ˆIntegerï¼‰** | INT8 / INT4 | æ•´æ•°è¡¨ç¤ºçš„é‡åŒ–æƒé‡ | æä½æ˜¾å­˜å ç”¨ï¼Œå¯èƒ½æŸå¤±ç²¾åº¦ |

ğŸ’¡ åœ¨è®¡ç®—æœºä¸­ï¼š
- FP32ï¼š32 ä½ï¼ˆ4 å­—èŠ‚ï¼‰è¡¨ç¤ºä¸€ä¸ªæµ®ç‚¹æ•°  
- FP16ï¼š16 ä½ï¼ˆ2 å­—èŠ‚ï¼‰è¡¨ç¤ºä¸€ä¸ªæµ®ç‚¹æ•°  
- INT8ï¼š8 ä½ï¼ˆ1 å­—èŠ‚ï¼‰è¡¨ç¤ºä¸€ä¸ªæ•´æ•°  

---

#### âš™ï¸ QLoRA ç®€ä»‹

> **QLoRAï¼ˆQuantized LoRAï¼‰**  
> æ˜¯ä¸€ç§ç»“åˆ **LoRA + 4-bit åŠ¨æ€é‡åŒ–** çš„åˆ›æ–°æ–¹æ³•ã€‚

é€šè¿‡ï¼š
- 4-bit é‡åŒ–åŸºç¡€æ¨¡å‹  
- åŒé‡åŒ– + è®­ç»ƒæ—¶åé‡åŒ–æœºåˆ¶  

QLoRA å®ç°äº†ï¼š
- ğŸš€ æ˜¾å­˜å ç”¨æä½  
- âœ… ä¿ç•™æ¢¯åº¦æ›´æ–°ç²¾åº¦  
- ğŸ’¨ è®­ç»ƒé€Ÿåº¦ä¸å†…å­˜æ•ˆç‡å…¼å¾—  

> å› æ­¤ï¼Œå½“åœ¨ LLaMA Factory ä¸­é€‰æ‹© **é‡åŒ–ç­‰çº§ï¼ˆå¦‚ 4-bitï¼‰** æ—¶ï¼Œé»˜è®¤ä½¿ç”¨çš„å¾®è°ƒæ–¹æ³•å°±æ˜¯ **QLoRA**ã€‚

---

### 4. å¯¹è¯æ¨¡æ¿ï¼ˆConversation Templateï¼‰

å¯¹è¯æ¨¡æ¿ï¼ˆConversation Templateï¼‰æ˜¯ LLM ä¸ç”¨æˆ·äº¤äº’çš„ **è¾“å…¥æ ¼å¼åŒ–å™¨**ã€‚  
ä¸åŒæ¨¡å‹ï¼ˆå¦‚ Llamaã€Qwenã€ChatGLMï¼‰æœ‰ä¸åŒçš„è¾“å…¥æ ¼å¼è¦æ±‚ã€‚

#### ğŸ§© ä½œç”¨

1. **è®­ç»ƒ-æ¨ç†ä¸€è‡´æ€§**ï¼š  
   æ¨¡å‹è®­ç»ƒä¸ä½¿ç”¨é˜¶æ®µçš„è¾“å…¥æ ¼å¼éœ€ä¿æŒä¸€è‡´ï¼Œå¦åˆ™æ€§èƒ½ä¼šæ˜¾è‘—ä¸‹é™ã€‚

2. **ä¸Šä¸‹æ–‡ç®¡ç†**ï¼š  
   æ¨¡æ¿å¸®åŠ©ç»„ç»‡å¤šè½®å¯¹è¯ã€åŒºåˆ†è¯´è¯è€…èº«ä»½ï¼ˆUser / Assistant / Systemï¼‰ã€‚

3. **é«˜çº§åŠŸèƒ½æ”¯æŒ**ï¼š  
   - ç³»ç»Ÿæç¤ºï¼ˆSystem Promptï¼‰  
   - å·¥å…·è°ƒç”¨ï¼ˆTool Callingï¼‰  
   - æ€ç»´é“¾ï¼ˆChain-of-Thoughtï¼‰  
   - å¤šæ¨¡æ€è¾“å…¥ï¼ˆå›¾åƒã€éŸ³é¢‘ç­‰ï¼‰

---

#### ğŸ§± Qwen å¯¹è¯æ¨¡æ¿ç¤ºä¾‹

```python
register_template(
    name="qwen",
    format_user=StringFormatter(slots=["<|im_start|>user\n{{content}}<|im_end|>\n<|im_start|>assistant\n"]),
    format_assistant=StringFormatter(slots=["{{content}}<|im_end|>\n"]),
    format_system=StringFormatter(slots=["<|im_start|>system\n{{content}}<|im_end|>\n"]),
    format_function=FunctionFormatter(slots=["{{content}}<|im_end|>\n"], tool_format="qwen"),
    format_observation=StringFormatter(
        slots=["<|im_start|>user\n<tool_response>\n{{content}}\n</tool_response><|im_end|>\n<|im_start|>assistant\n"]
    ),
    format_tools=ToolFormatter(tool_format="qwen"),
    default_system="You are Qwen, created by Alibaba Cloud. You are a helpful assistant.",
    stop_words=["<|im_end|>"],
    replace_eos=True,
)
````

ğŸ“œ **ç¤ºä¾‹è¾“å…¥è¾“å‡º**

**ç”¨æˆ·è¾“å…¥ï¼š**

> å¸®æˆ‘å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—

**æ ¼å¼åŒ–åï¼š**

```
<|im_start|>system
You are Qwen, created by Alibaba Cloud. You are a helpful assistant.
<|im_end|>

<|im_start|>user
å¸®æˆ‘å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—
<|im_end|>

<|im_start|>assistant
```

æ¨¡å‹åœ¨ `<|im_start|>assistant` åå¼€å§‹ç”Ÿæˆæ–‡æœ¬ï¼Œç›´åˆ° `<|im_end|>` åœæ­¢ã€‚

---

### 5. åŠ é€Ÿæ–¹å¼ï¼ˆAcceleration Methodsï¼‰

LLaMA Factory æ”¯æŒå¤šç§åŠ é€Ÿæ–¹æ³•ï¼š

| åŠ é€Ÿæ–¹æ³•                 | è¯´æ˜                                                  | é…ç½®å‚æ•°                        |
| -------------------- | --------------------------------------------------- | --------------------------- |
| **FlashAttention-2** | æé«˜æ³¨æ„åŠ›è®¡ç®—é€Ÿåº¦ã€å‡å°‘æ˜¾å­˜å ç”¨                                    | `flash_attn: fa2`           |
| **Unsloth**          | æ”¯æŒ LLaMAã€Mistralã€Qwenã€Phi ç­‰æ¨¡å‹ï¼›ä¼˜åŒ– QLoRA/LoRA å¾®è°ƒé€Ÿåº¦ä¸æ˜¾å­˜ | `use_unsloth: True`         |
| **Liger Kernel**     | ä¼˜åŒ–å¤§æ¨¡å‹è®­ç»ƒååé‡ä¸æ˜¾å­˜ä½¿ç”¨                                     | `enable_liger_kernel: True` |

> âš™ï¸ **æ¨èé…ç½®**
> è‹¥æœ¬åœ°ç¡¬ä»¶èµ„æºæœ‰é™ï¼Œå¯é€‰æ‹© **Unsloth + 4-bit é‡åŒ–**ï¼›
> è‹¥å¯¹æ€§èƒ½è¦æ±‚ä¸€èˆ¬ï¼Œå¯ä¿ç•™é»˜è®¤ï¼ˆFlashAttentionï¼‰ã€‚

---

## å…­ã€æ•°æ®é›†ï¼ˆDatasetï¼‰

åœ¨ **LLaMA Factory** ä¸­ä¸»è¦æ”¯æŒä»¥ä¸‹ä¸¤ç§æ•°æ®æ ¼å¼ï¼š

* ğŸŸ¦ **Alpaca æ ¼å¼**ï¼ˆå•è½®æŒ‡ä»¤æ•°æ®ï¼‰
* ğŸŸ© **ShareGPT æ ¼å¼**ï¼ˆå¤šè½®å¯¹è¯æ•°æ®ï¼‰

---

### ğŸ“ æ•°æ®é›†é…ç½®ä½ç½®

åœ¨ `Train` é€‰é¡¹ä¸‹ï¼ŒLLaMA Factory æä¾›äº†ä¸¤ä¸ªä¸æ•°æ®é›†ç›¸å…³çš„é…ç½®é¡¹ï¼š

| é…ç½®é¡¹                        | è¯´æ˜                    |
| :------------------------- | :-------------------- |
| **æ•°æ®è·¯å¾„ï¼ˆdata pathï¼‰**        | é»˜è®¤æŒ‡å‘é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„ `data` ç›®å½• |
| **æ•°æ®é›†ï¼ˆdataset_info.jsonï¼‰** | ç®¡ç†æ‰€æœ‰æ•°æ®é›†çš„åŠ è½½ä¸æ˜ å°„é…ç½®       |

å…¶åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š

```json
{
  "æ•°æ®é›†åç§°": {
    "é…ç½®é¡¹1": "å€¼1",
    "é…ç½®é¡¹2": "å€¼2"
  }
}
```

---

### ğŸŒ æ•°æ®æºå®šä¹‰æ–¹å¼

LLaMA Factory æ”¯æŒ **ä¸‰ç§æ•°æ®æºåŠ è½½æ–¹å¼**ï¼š

#### â‘  åœ¨çº¿æ•°æ®é›†

æ¥æºå¹³å°ï¼š**Hugging Face Hub**ã€**ModelScope Hub**ã€**OpenMind Hub**

```json
"alpaca_en": {
  "hf_hub_url": "llamafactory/alpaca_en",
  "ms_hub_url": "llamafactory/alpaca_en",
  "om_hub_url": "HaM/alpaca_en"
}
```

#### â‘¡ æœ¬åœ°æ–‡ä»¶

é€šè¿‡ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„æŒ‡å®šæœ¬åœ°æ•°æ®æ–‡ä»¶ï¼š

```json
"alpaca_en_demo": {
  "file_name": "alpaca_en_demo.json"
}
```

#### â‘¢ è‡ªå®šä¹‰è„šæœ¬ç”Ÿæˆæ•°æ®é›†

é€šè¿‡è„šæœ¬è‡ªåŠ¨åŠ è½½æˆ–ç”Ÿæˆæ•°æ®ï¼š

```json
"belle_multiturn": {
  "script_url": "belle_multiturn",
  "formatting": "sharegpt"
}
```

---

### ğŸ§© æ•°æ®æ ¼å¼é…ç½®

#### ï¼ˆ1ï¼‰åŸºæœ¬æ ¼å¼ç±»å‹

é€šè¿‡ `formatting` å­—æ®µæŒ‡å®šæ•°æ®æ ¼å¼ï¼š

```json
"slimorca": {
  "hf_hub_url": "Open-Orca/SlimOrca",
  "formatting": "sharegpt"
}
```

#### ï¼ˆ2ï¼‰åˆ—æ˜ å°„é…ç½®

å°†åŸå§‹æ•°æ®å­—æ®µæ˜ å°„ä¸ºæ ‡å‡†å­—æ®µï¼š

```json
"openorca": {
  "hf_hub_url": "Open-Orca/OpenOrca",
  "columns": {
    "prompt": "question",
    "response": "response",
    "system": "system_prompt"
  }
}
```

#### ï¼ˆ3ï¼‰è§’è‰²æ ‡ç­¾é…ç½®ï¼ˆShareGPT æ ¼å¼ï¼‰

è‡ªå®šä¹‰ç”¨æˆ·ä¸åŠ©æ‰‹çš„è§’è‰²æ ‡ç­¾ï¼š

```json
"mllm_demo": {
  "formatting": "sharegpt",
  "tags": {
    "role_tag": "role",
    "content_tag": "content",
    "user_tag": "user",
    "assistant_tag": "assistant"
  }
}
```

#### ï¼ˆ4ï¼‰å¤šæ¨¡æ€æ•°æ®æ”¯æŒ

æ”¯æŒæ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ç­‰æ•°æ®ï¼š

```json
"mllm_demo": {
  "file_name": "mllm_demo.json",
  "formatting": "sharegpt",
  "columns": {
    "messages": "messages",
    "images": "images"
  }
}
```

---

### âš™ï¸ ç‰¹æ®Šè®­ç»ƒä»»åŠ¡é…ç½®

#### âœ… æ’åº / å¯¹æ¯”å­¦ä¹ æ•°æ®ï¼ˆRLHF / DPOï¼‰

```json
"webgpt": {
  "hf_hub_url": "openai/webgpt_comparisons",
  "ranking": true,
  "columns": {
    "prompt": "question",
    "chosen": "answer_0",
    "rejected": "answer_1"
  }
}
```

#### ğŸ§° å·¥å…·è°ƒç”¨ï¼ˆTool Callingï¼‰æ•°æ®

```json
"glaive_toolcall_en_demo": {
  "file_name": "glaive_toolcall_en_demo.json",
  "formatting": "sharegpt",
  "columns": {
    "messages": "conversations",
    "tools": "tools"
  }
}
```

---

ğŸ“„ **å»¶ä¼¸é˜…è¯»**

> æ•°æ®é›†æ„é€ ä¸è‡ªå®šä¹‰æ–¹æ³•è¯¦è§ï¼š[`æ•°æ®é›†çš„æ„é€ .md`](./æ•°æ®é›†çš„æ„é€ .md)
